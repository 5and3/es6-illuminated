!function(t){function e(o){if(n[o])return n[o].exports;var i=n[o]={exports:{},id:o,loaded:!1};return t[o].call(i.exports,i,i.exports,e),i.loaded=!0,i.exports}var n={};return e.m=t,e.c=n,e.p="/built/",e(0)}([function(t,e,n){t.exports=n(1)},function(t,e,n){"use strict";function o(t){return t&&t.__esModule?t:{default:t}}var i=n(2),s=o(i),r=n(3),a=o(r),u=n(6),c=o(u),l=n(7),f=o(l),h=n(9),p=o(h),d=document.getElementById("screen"),y=d.getContext("2d"),v=new c.default({position:new s.default(200,150),distance:200}),b=new f.default({center:new s.default(100,100),radius:30}),g=new p.default({topleft:new s.default(250,200),bottomright:new s.default(350,250)});console.log("RECT",g);var m=new a.default({light:v,objects:[b,g]});m.compute(d.width,d.height),y.fillStyle="black",y.fillRect(0,0,d.width,d.height),m.render(y)},function(t,e){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var o=function(){function t(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(e,n,o){return n&&t(e.prototype,n),o&&t(e,o),e}}(),i=function(){function t(e,o){n(this,t),this.x=e||0,this.y=o||0}return o(t,[{key:"copy",value:function(){return new t(this.x,this.y)}},{key:"dot",value:function(t){return t.x*this.x+t.y*this.y}},{key:"sub",value:function(e){return new t(this.x-e.x,this.y-e.y)}},{key:"add",value:function(e){return new t(this.x+e.x,this.y+e.y)}},{key:"mul",value:function(e){return new t(this.x*e,this.y*e)}},{key:"inv",value:function(){return this.mul(-1)}},{key:"dist2",value:function(t){var e=this.x-t.x,n=this.y-t.y;return e*e+n*n}},{key:"normalize",value:function(){var e=Math.sqrt(this.length2());return new t(this.x/e,this.y/e)}},{key:"length2",value:function(t){return this.x*this.x+this.y*this.y}},{key:"toString",value:function(){return this.x+","+this.y}},{key:"inBound",value:function(t,e){return t.x<this.x&&this.x<e.x&&t.y<this.y&&this.y<e.y}}]),t}();e.default=i},function(t,e,n){"use strict";function o(t){return t&&t.__esModule?t:{default:t}}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var s=function(){function t(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(e,n,o){return n&&t(e.prototype,n),o&&t(e,o),e}}(),r=n(4),a=n(5),u=o(a),c=function(){function t(e){i(this,t);var n={light:new u.default,objects:[]};this.options=Object.assign(n,this.options),this.options=Object.assign(this.options,e)}return s(t,[{key:"createCache",value:function(t,e){this._cache=(0,r.createCanvasAnd2dContext)("lc",t,e),this._castcache=(0,r.createCanvasAnd2dContext)("lcc",t,e)}},{key:"cast",value:function(t){var e=this.options.light,n=e.samples,o=this._castcache,i=o.ctx;i.clearRect(0,0,o.w,o.h),i.fillStyle="rgba(0,0,0,"+Math.round(100/n)/100+")";var s=e.bounds(),r=this.options.objects;e.forEachSample(function(t){for(var e=0,n=r.length;e<n;++e)if(r[e].contains(t))return void i.fillRect(s.topleft.x,s.topleft.y,s.bottomright.x-s.topleft.x,s.bottomright.y-s.topleft.y);r.forEach(function(e){e.cast(i,t,s)})}),r.forEach(function(t){var n=void 0===t.diffuse?.8:t.diffuse;n*=e.diffuse,i.fillStyle="rgba(0,0,0,"+(1-n)+")",i.beginPath(),t.path(i),i.fill()}),t.drawImage(o.canvas,0,0)}},{key:"compute",value:function(t,e){this._cache&&this._cache.w==t&&this._cache.h==e||this.createCache(t,e);var n=this._cache.ctx,o=this.options.light;n.save(),n.clearRect(0,0,n.canvas.width,n.canvas.height),o.render(n),n.globalCompositeOperation="destination-out",this.cast(n),n.restore()}},{key:"render",value:function(t){t.drawImage(this._cache.canvas,0,0)}},{key:"getCanvas",value:function(){return this._cache.canvas}}]),t}();e.default=c},function(t,e,n){"use strict";function o(t){return t&&t.__esModule?t:{default:t}}function i(t,e,n){var o=e[0];t.moveTo(o.x,o.y);for(var i=1,s=e.length;i<s;++i)o=e[i],t.lineTo(o.x,o.y);!n&&e.length>2&&(o=e[0],t.lineTo(o.x,o.y))}function s(t,e,n){var o="illujs_"+t,i=document.getElementById(o);if(null===i){var i=document.createElement("canvas");i.id=o,i.width=e,i.height=n,i.style.display="none",document.body.appendChild(i)}var s=i.getContext("2d");return s.clearRect(0,0,i.width,i.height),i.width=e,i.height=n,{canvas:i,ctx:s,w:e,h:n}}function r(t,e){var n,o,i,s,u=r.epsilon||1e-6,l=[],f=t;if("object"===("undefined"==typeof f?"undefined":a(f))&&"number"==typeof e){var h=f;e=f,e=h}"number"==typeof e?(n=e,o=arguments[2],i=n*n+o*o):(n=e.x,o=e.y,i=e.length2());var p=o*Math.sqrt(i-f*f),d=Math.acos((-f*n+p)/i),y=Math.acos((-f*n-p)/i),v=f*Math.cos(d),b=f*Math.sin(d),g=f*Math.cos(y),m=f*Math.sin(y);s=new c.default(n+g,o+m),l.push(s);var w=s.length2();s=new c.default(n+v,o-b),l.push(s);var _=s.length2();if(Math.abs(w-_)<u)return l;s=new c.default(n+g,o-m),l.push(s);var x=s.length2();if(Math.abs(_-x)<u)return[s,l[1]];if(Math.abs(w-x)<u)return[l[0],s];s=new c.default(n+v,o+b),l.push(s);var k=s.length2();return Math.abs(x-k)<u?[l[2],s]:Math.abs(_-k)<u?[l[1],s]:Math.abs(w-k)<u?[l[0],s]:l}Object.defineProperty(e,"__esModule",{value:!0}),e.path=e.getTan2=e.getRGBA=e.createCanvasAnd2dContext=e._2PI=e.GOLDEN_ANGLE=void 0;var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},u=n(2),c=o(u),l=(e.GOLDEN_ANGLE=Math.PI*(3-Math.sqrt(5)),e._2PI=2*Math.PI,function(){var t=document.createElement("canvas");t.width=t.height=1;var e=t.getContext("2d");return function(t,n){e.clearRect(0,0,1,1),e.fillStyle=t,e.fillRect(0,0,1,1);var o=e.getImageData(0,0,1,1).data;return"rgba("+[o[0],o[1],o[2],n]+")"}}());e.createCanvasAnd2dContext=s,e.getRGBA=l,e.getTan2=r,e.path=i},function(t,e,n){"use strict";function o(t){return t&&t.__esModule?t:{default:t}}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var s=function(){function t(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(e,n,o){return n&&t(e.prototype,n),o&&t(e,o),e}}(),r=n(2),a=o(r),u=function(){function t(e){i(this,t);var n={position:new a.default,distance:100,diffuse:.8};this.options=Object.assign(n,e)}return s(t,[{key:"render",value:function(t){}},{key:"mask",value:function(t){var e=this._getVisibleMaskCache();t.drawImage(e.canvas,Math.round(this.options.position.x-e.w/2),Math.round(this.options.position.y-e.h/2))}},{key:"bounds",value:function(){return{topleft:new a.default(this.options.position.x-this.options.distance,this.options.position.y-this.options.distance),bottomright:new a.default(this.options.position.x+this.options.distance,this.options.position.y+this.options.distance)}}},{key:"center",value:function(){return new a.default(this.options.distance,this.options.distance)}},{key:"forEachSample",value:function(t){t(this.options.position)}},{key:"_getVisibleMaskCache",value:function(){var t=Math.floor(1.4*this.options.distance),e=""+t;if(this.vismaskhash!=e){this.vismaskhash=e;var n=this._vismaskcache=createCanvasAnd2dContext("vm"+this.id,2*t,2*t),o=n.ctx.createRadialGradient(t,t,0,t,t,t);o.addColorStop(0,"rgba(0,0,0,1)"),o.addColorStop(1,"rgba(0,0,0,0)"),n.ctx.fillStyle=o,n.ctx.fillRect(0,0,n.w,n.h)}return this._vismaskcache}},{key:"_getHashCache",value:function(){return[this.options.distance,this.options.diffuse].toString()}}]),t}();e.default=u},function(t,e,n){"use strict";function o(t){return t&&t.__esModule?t:{default:t}}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function s(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function r(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var a=function(){function t(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(e,n,o){return n&&t(e.prototype,n),o&&t(e,o),e}}(),u=n(2),c=o(u),l=n(5),f=o(l),h=n(4),p=function(t){function e(t){i(this,e);var n=s(this,(e.__proto__||Object.getPrototypeOf(e)).call(this)),o={id:0,color:"rgba(250,220,150,0.8)",radius:0,samples:1,angle:0,roughness:0};return n.options=Object.assign(o,n.options),n.options=Object.assign(n.options,t),n}return r(e,t),a(e,[{key:"_getHashCache",value:function(){return[this.options.color,this.options.distance,this.options.diffuse,this.options.angle,this.options.roughness,this.options.samples,this.options.radius].toString()}},{key:"center",value:function(){return new c.default((1-Math.cos(this.options.angle)*this.options.roughness)*this.options.distance,(1+Math.sin(this.options.angle)*this.options.roughness)*this.options.distance)}},{key:"bounds",value:function(){var t=new c.default(Math.cos(this.options.angle),-Math.sin(this.options.angle)).mul(this.options.roughness*this.options.distance);return{topleft:new c.default(this.options.position.x+t.x-this.options.distance,this.options.position.y+t.y-this.options.distance),bottomright:new c.default(this.options.position.x+t.x+this.options.distance,this.options.position.y+t.y+this.options.distance)}}},{key:"mask",value:function(t){var e=this._getVisibleMaskCache(),n=new c.default(Math.cos(this.options.angle),-Math.sin(this.options.angle)).mul(this.options.roughness*this.options.distance);t.drawImage(e.canvas,Math.round(this.options.position.x+n.x-e.w/2),Math.round(this.options.position.y+n.y-e.h/2))}},{key:"_getGradientCache",value:function(t){var e=this._getHashCache();if(this._cacheHashcode==e)return this._gcache;this._cacheHashcode=e;var n=Math.round(this.options.distance),o=2*n,i=(0,h.createCanvasAnd2dContext)("gc"+this.id,o,o),s=i.ctx.createRadialGradient(t.x,t.y,0,n,n,n);return s.addColorStop(Math.min(1,this.options.radius/this.options.distance),this.options.color),s.addColorStop(1,(0,h.getRGBA)(this.options.color,0)),i.ctx.fillStyle=s,i.ctx.fillRect(0,0,i.w,i.h),this._gcache=i}},{key:"render",value:function(t){var e=this.center(),n=this._getGradientCache(e);t.drawImage(n.canvas,Math.round(this.options.position.x-e.x),Math.round(this.options.position.y-e.y))}}]),e}(f.default);e.default=p},function(t,e,n){"use strict";function o(t){return t&&t.__esModule?t:{default:t}}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function s(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function r(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var a=function(){function t(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(e,n,o){return n&&t(e.prototype,n),o&&t(e,o),e}}(),u=n(2),c=o(u),l=n(4),f=n(8),h=o(f),p=function(t){function e(t){i(this,e);var n=s(this,(e.__proto__||Object.getPrototypeOf(e)).call(this)),o={center:new c.default,radius:20};return n.options=Object.assign(o,n.options),n.options=Object.assign(n.options,t),n}return r(e,t),a(e,[{key:"cast",value:function(t,e,n){var o=this.options.center,i=o.sub(e),s=(0,l.getTan2)(this.options.radius,i),r=s[0],a=s[1],u=r.add(e),c=a.add(e),f=(n.bottomright.x-n.topleft.x+(n.bottomright.y-n.topleft.y))/2;i=i.normalize().mul(f),r=r.normalize().mul(f),a=a.normalize().mul(f);var h=u.add(i),p=c.add(i),d=u.add(r),y=c.add(a),v=Math.atan2(i.x,-i.y);t.beginPath(),(0,l.path)(t,[c,y,p,h,d,u],!0),t.arc(o.x,o.y,this.options.radius,v,v+Math.PI),t.fill()}},{key:"path",value:function(t){t.arc(this.options.center.x,this.options.center.y,this.options.radius,0,l._2PI)}},{key:"bounds",value:function(){return{topleft:new c.default(this.options.center.x-this.options.radius,this.options.center.y-this.options.radius),bottomright:new c.default(this.options.center.x+this.options.radius,this.options.center.y+this.options.radius)}}},{key:"contains",value:function(t){return t.dist2(this.options.center)<this.options.radius*this.options.radius}}]),e}(h.default);e.default=p},function(t,e){"use strict";function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0});var o=function(){function t(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(e,n,o){return n&&t(e.prototype,n),o&&t(e,o),e}}(),i=function(){function t(e){n(this,t);var o={diffuse:.8};this.options=Object.assign(o,e),this.uniqueId=0}return o(t,[{key:"cast",value:function(t,e,n){}},{key:"path",value:function(t){}},{key:"bounds",value:function(){return{topleft:new Vec2,bottomright:new Vec2}}},{key:"contains",value:function(t){return!1}}]),t}();e.default=i},function(t,e,n){"use strict";function o(t){return t&&t.__esModule?t:{default:t}}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function s(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function r(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var a=function(){function t(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(e,n,o){return n&&t(e.prototype,n),o&&t(e,o),e}}(),u=n(2),c=o(u),l=n(10),f=o(l),h=function(t){function e(t){i(this,e);var n=s(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t)),o={topleft:new c.default,bottomright:new c.default};return n.options=Object.assign(o,n.options),n.options=Object.assign(n.options,t),n.syncFromTopleftBottomright(),n}return r(e,t),a(e,[{key:"syncFromTopleftBottomright",value:function(){var t=this.options.topleft,e=new c.default(this.options.bottomright.x,this.options.topleft.y),n=this.options.bottomright,o=new c.default(this.options.topleft.x,this.options.bottomright.y);this.options.points=[t,e,n,o]}},{key:"fill",value:function(t){var e=this.options.points[0].x,n=this.options.points[0].y;t.rect(e,n,this.options.points[2].x-e,this.options.points[2].y-n)}}]),e}(f.default);e.default=h},function(t,e,n){"use strict";function o(t){return t&&t.__esModule?t:{default:t}}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function s(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function r(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(e,"__esModule",{value:!0});var a=function(){function t(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(e,n,o){return n&&t(e.prototype,n),o&&t(e,o),e}}(),u=n(2),c=o(u),l=n(4),f=n(8),h=o(f),p=function(t){function e(t){i(this,e);var n=s(this,(e.__proto__||Object.getPrototypeOf(e)).call(this)),o={points:[]};return n.options=Object.assign(o,n.options),n.options=Object.assign(n.options,t),n}return r(e,t),a(e,[{key:"bounds",value:function(){for(var t=this.options.points[0].copy(),e=t.copy(),n=1,o=this.options.points.length;n<o;++n){var i=this.options.points[n];i.x>e.x&&(e.x=i.x),i.y>e.y&&(e.y=i.y),i.x<t.x&&(t.x=i.x),i.y<t.y&&(t.y=i.y)}return{topleft:t,bottomright:e}}},{key:"contains",value:function(t){var e,n=this.options.points,o=n.length,i=o-1,s=t.x,r=t.y,a=!1;for(e=0;e<o;e++)(n[e].y<r&&n[i].y>=r||n[i].y<r&&n[e].y>=r)&&(n[e].x<=s||n[i].x<=s)&&n[e].x+(r-n[e].y)/(n[i].y-n[e].y)*(n[i].x-n[e].x)<s&&(a=!a),i=e;return a}},{key:"path",value:function(t){(0,l.path)(t,this.options.points)}},{key:"cast",value:function(t,e,n){var o=(n.bottomright.x-n.topleft.x+(n.bottomright.y-n.topleft.y))/2;this._forEachVisibleEdges(e,n,function(n,i,s,r,a){var u,c=s.inv().dot(a)/a.length2();u=c<0?n:c>1?i:n.add(a.mul(c));var f=u.sub(e);f=f.normalize().mul(o),s=s.normalize().mul(o),r=r.normalize().mul(o);var h=n.add(f),p=i.add(f),d=n.add(s),y=i.add(r);t.beginPath(),(0,l.path)(t,[n,i,y,p,h,d]),t.fill()})}},{key:"_forEachVisibleEdges",value:function(t,e,n){for(var o,i=this.options.points[this.options.points.length-1],s=0,r=this.options.points.length;s<r;++s,i=o)if(o=this.options.points[s],i.inBound(e.topleft,e.bottomright)){var a=i.sub(t),u=o.sub(t),l=o.sub(i),f=new c.default(l.y,-l.x);f.dot(a)<0&&n(i,o,a,u,l)}}}]),e}(h.default);e.default=p}]);
//# sourceMappingURL=illuminated.js.map