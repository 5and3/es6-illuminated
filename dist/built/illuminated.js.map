{"version":3,"sources":["illuminated.js","webpack/bootstrap ef47299c52806ce75b3c","./src/illuminated.js","./src/Vec2.js","./src/Lighting.js","./src/helpers.js","./src/Light.js","./src/Lamp.js","./src/DiscObject.js","./src/OpaqueObject.js","./src/RectangleObject.js","./src/PolygonObject.js"],"names":["modules","__webpack_require__","moduleId","installedModules","exports","module","id","loaded","call","m","c","p","_interopRequireDefault","obj","__esModule","default","_Vec","_Vec2","_Lighting","_Lighting2","_Lamp","_Lamp2","_DiscObject","_DiscObject2","_RectangleObject","_RectangleObject2","canvas","document","getElementById","ctx","getContext","light","Lamp","position","Vec2","distance","disc","DiscObject","center","radius","rect","RectangleObject","topleft","bottomright","console","log","lighting","Lighting","objects","compute","width","height","fillStyle","fillRect","render","_classCallCheck","instance","Constructor","TypeError","Object","defineProperty","value","_createClass","defineProperties","target","props","i","length","descriptor","enumerable","configurable","writable","key","protoProps","staticProps","prototype","x","y","this","v","n","mul","dx","dy","Math","sqrt","length2","topLeft","bottomRight","_helpers","_Light","_Light2","options","defaults","Light","assign","w","h","_cache","createCanvasAnd2dContext","_castcache","ctxoutput","samples","clearRect","round","bounds","forEachSample","o","l","contains","forEach","object","cast","diffuse","undefined","beginPath","path","fill","drawImage","createCache","save","globalCompositeOperation","restore","points","dontJoinLast","moveTo","lineTo","iid","createElement","style","display","body","appendChild","getTan2","x0","y0","len2","soln","epsilon","solutions","a","_typeof","tmp","arguments","len2a","tt","acos","nt","tt_cos","cos","tt_sin","sin","nt_cos","nt_sin","push","dist0","dist1","abs","dist2","dist3","getRGBA","_2PI","GOLDEN_ANGLE","Symbol","iterator","constructor","PI","color","alpha","d","getImageData","data","_getVisibleMaskCache","f","floor","hash","vismaskhash","_vismaskcache","g","createRadialGradient","addColorStop","toString","_possibleConstructorReturn","self","ReferenceError","_inherits","subClass","superClass","create","setPrototypeOf","__proto__","_Light3","_this","getPrototypeOf","angle","roughness","orientationCenter","hashcode","_getHashCache","_cacheHashcode","_gcache","D","cache","min","_getGradientCache","_OpaqueObject2","_OpaqueObject3","_OpaqueObject","origin","originToM","sub","tangentLines","originToA","originToB","add","b","normalize","oam","obm","ap","bp","start","atan2","arc","point","OpaqueObject","uniqueId","_PolygonObject2","_PolygonObject3","_PolygonObject","syncFromTopleftBottomright","PolygonObject","copy","j","oddNodes","_forEachVisibleEdges","aToB","t","inv","dot","inBound","normal"],"mappings":"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","file":"illuminated.js","sourcesContent":["/******/ (function(modules) { // webpackBootstrap\n/******/ \t// The module cache\n/******/ \tvar installedModules = {};\n/******/\n/******/ \t// The require function\n/******/ \tfunction __webpack_require__(moduleId) {\n/******/\n/******/ \t\t// Check if module is in cache\n/******/ \t\tif(installedModules[moduleId])\n/******/ \t\t\treturn installedModules[moduleId].exports;\n/******/\n/******/ \t\t// Create a new module (and put it into the cache)\n/******/ \t\tvar module = installedModules[moduleId] = {\n/******/ \t\t\texports: {},\n/******/ \t\t\tid: moduleId,\n/******/ \t\t\tloaded: false\n/******/ \t\t};\n/******/\n/******/ \t\t// Execute the module function\n/******/ \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n/******/\n/******/ \t\t// Flag the module as loaded\n/******/ \t\tmodule.loaded = true;\n/******/\n/******/ \t\t// Return the exports of the module\n/******/ \t\treturn module.exports;\n/******/ \t}\n/******/\n/******/\n/******/ \t// expose the modules object (__webpack_modules__)\n/******/ \t__webpack_require__.m = modules;\n/******/\n/******/ \t// expose the module cache\n/******/ \t__webpack_require__.c = installedModules;\n/******/\n/******/ \t// __webpack_public_path__\n/******/ \t__webpack_require__.p = \"/built/\";\n/******/\n/******/ \t// Load entry module and return exports\n/******/ \treturn __webpack_require__(0);\n/******/ })\n/************************************************************************/\n/******/ ([\n/* 0 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\tmodule.exports = __webpack_require__(1);\n\n\n/***/ }),\n/* 1 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\t\n\tvar _Vec = __webpack_require__(2);\n\t\n\tvar _Vec2 = _interopRequireDefault(_Vec);\n\t\n\tvar _Lighting = __webpack_require__(3);\n\t\n\tvar _Lighting2 = _interopRequireDefault(_Lighting);\n\t\n\tvar _Lamp = __webpack_require__(6);\n\t\n\tvar _Lamp2 = _interopRequireDefault(_Lamp);\n\t\n\tvar _DiscObject = __webpack_require__(7);\n\t\n\tvar _DiscObject2 = _interopRequireDefault(_DiscObject);\n\t\n\tvar _RectangleObject = __webpack_require__(9);\n\t\n\tvar _RectangleObject2 = _interopRequireDefault(_RectangleObject);\n\t\n\tfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\t\n\t//!STAexport RT\n\tvar canvas = document.getElementById(\"screen\");\n\tvar ctx = canvas.getContext(\"2d\");\n\tvar light = new _Lamp2.default({\n\t    position: new _Vec2.default(200, 150),\n\t    distance: 200\n\t});\n\tvar disc = new _DiscObject2.default({\n\t    center: new _Vec2.default(100, 100),\n\t    radius: 30\n\t});\n\tvar rect = new _RectangleObject2.default({\n\t    topleft: new _Vec2.default(250, 200),\n\t    bottomright: new _Vec2.default(350, 250)\n\t});\n\tconsole.log(\"RECT\", rect);\n\tvar lighting = new _Lighting2.default({\n\t    light: light,\n\t    objects: [disc, rect]\n\t});\n\tlighting.compute(canvas.width, canvas.height);\n\tctx.fillStyle = \"black\";\n\tctx.fillRect(0, 0, canvas.width, canvas.height);\n\tlighting.render(ctx);\n\n/***/ }),\n/* 2 */\n/***/ (function(module, exports) {\n\n\t\"use strict\";\n\t\n\tObject.defineProperty(exports, \"__esModule\", {\n\t    value: true\n\t});\n\t\n\tvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\t\n\tfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\t\n\tvar Vec2 = function () {\n\t    function Vec2(x, y) {\n\t        _classCallCheck(this, Vec2);\n\t\n\t        this.x = x || 0;\n\t        this.y = y || 0;\n\t    }\n\t\n\t    _createClass(Vec2, [{\n\t        key: \"copy\",\n\t        value: function copy() {\n\t            return new Vec2(this.x, this.y);\n\t        }\n\t    }, {\n\t        key: \"dot\",\n\t        value: function dot(v) {\n\t            return v.x * this.x + v.y * this.y;\n\t        }\n\t    }, {\n\t        key: \"sub\",\n\t        value: function sub(v) {\n\t            return new Vec2(this.x - v.x, this.y - v.y);\n\t        }\n\t    }, {\n\t        key: \"add\",\n\t        value: function add(v) {\n\t            return new Vec2(this.x + v.x, this.y + v.y);\n\t        }\n\t    }, {\n\t        key: \"mul\",\n\t        value: function mul(n) {\n\t            return new Vec2(this.x * n, this.y * n);\n\t        }\n\t    }, {\n\t        key: \"inv\",\n\t        value: function inv() {\n\t            return this.mul(-1);\n\t        }\n\t    }, {\n\t        key: \"dist2\",\n\t        value: function dist2(v) {\n\t            var dx = this.x - v.x;\n\t            var dy = this.y - v.y;\n\t            return dx * dx + dy * dy;\n\t        }\n\t    }, {\n\t        key: \"normalize\",\n\t        value: function normalize() {\n\t            var length = Math.sqrt(this.length2());\n\t            return new Vec2(this.x / length, this.y / length);\n\t        }\n\t    }, {\n\t        key: \"length2\",\n\t        value: function length2(v) {\n\t            return this.x * this.x + this.y * this.y;\n\t        }\n\t    }, {\n\t        key: \"toString\",\n\t        value: function toString() {\n\t            return this.x + \",\" + this.y;\n\t        }\n\t    }, {\n\t        key: \"inBound\",\n\t        value: function inBound(topLeft, bottomRight) {\n\t            return topLeft.x < this.x && this.x < bottomRight.x && topLeft.y < this.y && this.y < bottomRight.y;\n\t        }\n\t    }]);\n\t\n\t    return Vec2;\n\t}();\n\t\n\texports.default = Vec2;\n\n/***/ }),\n/* 3 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\t\n\tObject.defineProperty(exports, \"__esModule\", {\n\t    value: true\n\t});\n\t\n\tvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\t\n\tvar _helpers = __webpack_require__(4);\n\t\n\tvar _Light = __webpack_require__(5);\n\t\n\tvar _Light2 = _interopRequireDefault(_Light);\n\t\n\tfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\t\n\tfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\t\n\tvar Lighting = function () {\n\t    function Lighting(options) {\n\t        _classCallCheck(this, Lighting);\n\t\n\t        var defaults = {\n\t            light: new _Light2.default(),\n\t            objects: []\n\t        };\n\t        this.options = Object.assign(defaults, this.options);\n\t        this.options = Object.assign(this.options, options);\n\t    }\n\t\n\t    _createClass(Lighting, [{\n\t        key: 'createCache',\n\t        value: function createCache(w, h) {\n\t            this._cache = (0, _helpers.createCanvasAnd2dContext)('lc', w, h);\n\t            this._castcache = (0, _helpers.createCanvasAnd2dContext)('lcc', w, h);\n\t        }\n\t    }, {\n\t        key: 'cast',\n\t        value: function cast(ctxoutput) {\n\t            var light = this.options.light;\n\t            var n = light.samples;\n\t            var c = this._castcache;\n\t            var ctx = c.ctx;\n\t            ctx.clearRect(0, 0, c.w, c.h);\n\t            // Draw shadows for each light sample and objects\n\t            ctx.fillStyle = \"rgba(0,0,0,\" + Math.round(100 / n) / 100 + \")\"; // Is there any better way?\n\t            var bounds = light.bounds();\n\t            var objects = this.options.objects;\n\t            light.forEachSample(function (position) {\n\t                var sampleInObject = false;\n\t                for (var o = 0, l = objects.length; o < l; ++o) {\n\t                    if (objects[o].contains(position)) {\n\t                        ctx.fillRect(bounds.topleft.x, bounds.topleft.y, bounds.bottomright.x - bounds.topleft.x, bounds.bottomright.y - bounds.topleft.y);\n\t                        return;\n\t                    }\n\t                }\n\t                objects.forEach(function (object) {\n\t                    object.cast(ctx, position, bounds);\n\t                });\n\t            });\n\t            // Draw objects diffuse - the intensity of the light penetration in objects\n\t            objects.forEach(function (object) {\n\t                var diffuse = object.diffuse === undefined ? 0.8 : object.diffuse;\n\t                diffuse *= light.diffuse;\n\t                ctx.fillStyle = \"rgba(0,0,0,\" + (1 - diffuse) + \")\";\n\t                ctx.beginPath();\n\t                object.path(ctx);\n\t                ctx.fill();\n\t            });\n\t            ctxoutput.drawImage(c.canvas, 0, 0);\n\t        }\n\t    }, {\n\t        key: 'compute',\n\t        value: function compute(w, h) {\n\t            if (!this._cache || this._cache.w != w || this._cache.h != h) this.createCache(w, h);\n\t            var ctx = this._cache.ctx;\n\t            var light = this.options.light;\n\t            ctx.save();\n\t            ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);\n\t\n\t            light.render(ctx);\n\t            ctx.globalCompositeOperation = \"destination-out\";\n\t            this.cast(ctx);\n\t            ctx.restore();\n\t        }\n\t    }, {\n\t        key: 'render',\n\t        value: function render(ctx) {\n\t            ctx.drawImage(this._cache.canvas, 0, 0);\n\t        }\n\t    }, {\n\t        key: 'getCanvas',\n\t        value: function getCanvas() {\n\t            return this._cache.canvas;\n\t        }\n\t    }]);\n\t\n\t    return Lighting;\n\t}();\n\t\n\texports.default = Lighting;\n\n/***/ }),\n/* 4 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\t\n\tObject.defineProperty(exports, \"__esModule\", {\n\t    value: true\n\t});\n\texports.path = exports.getTan2 = exports.getRGBA = exports.createCanvasAnd2dContext = exports._2PI = exports.GOLDEN_ANGLE = undefined;\n\t\n\tvar _typeof = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; };\n\t\n\tvar _Vec = __webpack_require__(2);\n\t\n\tvar _Vec2 = _interopRequireDefault(_Vec);\n\t\n\tfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\t\n\tvar GOLDEN_ANGLE = exports.GOLDEN_ANGLE = Math.PI * (3 - Math.sqrt(5));\n\tvar _2PI = exports._2PI = 2 * Math.PI;\n\t\n\tfunction path(ctx, points, dontJoinLast) {\n\t    var p = points[0];\n\t    ctx.moveTo(p.x, p.y);\n\t    for (var i = 1, l = points.length; i < l; ++i) {\n\t        p = points[i];\n\t        ctx.lineTo(p.x, p.y);\n\t    }\n\t    if (!dontJoinLast && points.length > 2) {\n\t        p = points[0];\n\t        ctx.lineTo(p.x, p.y);\n\t    }\n\t}\n\t\n\tfunction createCanvasAnd2dContext(id, w, h) {\n\t    var iid = 'illujs_' + id;\n\t    var canvas = document.getElementById(iid);\n\t\n\t    if (canvas === null) {\n\t        var canvas = document.createElement(\"canvas\");\n\t        canvas.id = iid;\n\t        canvas.width = w;\n\t        canvas.height = h;\n\t        canvas.style.display = 'none';\n\t        document.body.appendChild(canvas);\n\t    }\n\t\n\t    var ctx = canvas.getContext(\"2d\");\n\t    ctx.clearRect(0, 0, canvas.width, canvas.height);\n\t\n\t    canvas.width = w;\n\t    canvas.height = h;\n\t\n\t    return {\n\t        canvas: canvas,\n\t        ctx: ctx,\n\t        w: w,\n\t        h: h\n\t    };\n\t}\n\t\n\tvar getRGBA = function () {\n\t    //var ctx = createCanvasAnd2dContext('grgba', 1, 1)\n\t    var canvas = document.createElement(\"canvas\");\n\t    canvas.width = canvas.height = 1;\n\t    var ctx = canvas.getContext(\"2d\");\n\t\n\t    return function (color, alpha) {\n\t        ctx.clearRect(0, 0, 1, 1);\n\t        ctx.fillStyle = color;\n\t        ctx.fillRect(0, 0, 1, 1);\n\t        var d = ctx.getImageData(0, 0, 1, 1).data;\n\t        return 'rgba(' + [d[0], d[1], d[2], alpha] + ')';\n\t    };\n\t}();\n\t\n\tfunction getTan2(radius, center) {\n\t    var epsilon = getTan2.epsilon || 1e-6,\n\t        // constant\n\t    x0,\n\t        y0,\n\t        len2,\n\t        soln,\n\t        solutions = [],\n\t        a = radius;\n\t    if ((typeof a === 'undefined' ? 'undefined' : _typeof(a)) === \"object\" && typeof center === \"number\") {\n\t        var tmp = a;\n\t        center = a;\n\t        center = tmp; // swap\n\t    }\n\t    if (typeof center === \"number\") {\n\t        // getTan2(radius:number, x0:number, y0:number)\n\t        x0 = center;\n\t        y0 = arguments[2];\n\t        len2 = x0 * x0 + y0 * y0;\n\t    } else {\n\t        // getTans2(radius:number, center:object={x:x0,y:y0})\n\t        x0 = center.x;\n\t        y0 = center.y;\n\t        len2 = center.length2();\n\t    }\n\t    // t = +/- Math.acos( (-a*x0 +/- y0 * Math.sqrt(x0*x0 + y0*y0 - a*a))/(x0*x0 + y0*y) )\n\t    var len2a = y0 * Math.sqrt(len2 - a * a),\n\t        tt = Math.acos((-a * x0 + len2a) / len2),\n\t        nt = Math.acos((-a * x0 - len2a) / len2),\n\t        tt_cos = a * Math.cos(tt),\n\t        tt_sin = a * Math.sin(tt),\n\t        nt_cos = a * Math.cos(nt),\n\t        nt_sin = a * Math.sin(nt);\n\t\n\t    // Note: cos(-t) == cos(t) and sin(-t) == -sin(t) for all t, so find\n\t    // x0 + a*cos(t), y0 +/- a*sin(t)\n\t    // Solutions have equal lengths\n\t    soln = new _Vec2.default(x0 + nt_cos, y0 + nt_sin);\n\t    solutions.push(soln);\n\t    var dist0 = soln.length2();\n\t\n\t    soln = new _Vec2.default(x0 + tt_cos, y0 - tt_sin);\n\t    solutions.push(soln);\n\t    var dist1 = soln.length2();\n\t    if (Math.abs(dist0 - dist1) < epsilon) return solutions;\n\t\n\t    soln = new _Vec2.default(x0 + nt_cos, y0 - nt_sin);\n\t    solutions.push(soln);\n\t    var dist2 = soln.length2();\n\t    // Changed order so no strange X of light inside the circle. Could also sort results.\n\t    if (Math.abs(dist1 - dist2) < epsilon) return [soln, solutions[1]];\n\t    if (Math.abs(dist0 - dist2) < epsilon) return [solutions[0], soln];\n\t\n\t    soln = new _Vec2.default(x0 + tt_cos, y0 + tt_sin);\n\t    solutions.push(soln);\n\t    var dist3 = soln.length2();\n\t    if (Math.abs(dist2 - dist3) < epsilon) return [solutions[2], soln];\n\t    if (Math.abs(dist1 - dist3) < epsilon) return [solutions[1], soln];\n\t    if (Math.abs(dist0 - dist3) < epsilon) return [solutions[0], soln];\n\t\n\t    // return all 4 solutions if no matching vector lengths found.\n\t    return solutions;\n\t}\n\t\n\texports.createCanvasAnd2dContext = createCanvasAnd2dContext;\n\texports.getRGBA = getRGBA;\n\texports.getTan2 = getTan2;\n\texports.path = path;\n\n/***/ }),\n/* 5 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\t\n\tObject.defineProperty(exports, \"__esModule\", {\n\t    value: true\n\t});\n\t\n\tvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\t\n\tvar _Vec = __webpack_require__(2);\n\t\n\tvar _Vec2 = _interopRequireDefault(_Vec);\n\t\n\tfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\t\n\tfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\t\n\tvar Light = function () {\n\t    function Light(options) {\n\t        _classCallCheck(this, Light);\n\t\n\t        var defaults = {\n\t            position: new _Vec2.default(),\n\t            distance: 100,\n\t            diffuse: 0.8\n\t        };\n\t        this.options = Object.assign(defaults, options);\n\t    }\n\t\n\t    _createClass(Light, [{\n\t        key: 'render',\n\t        value: function render(ctx) {}\n\t    }, {\n\t        key: 'mask',\n\t        value: function mask(ctx) {\n\t            var c = this._getVisibleMaskCache();\n\t            ctx.drawImage(c.canvas, Math.round(this.options.position.x - c.w / 2), Math.round(this.options.position.y - c.h / 2));\n\t        }\n\t    }, {\n\t        key: 'bounds',\n\t        value: function bounds() {\n\t            return {\n\t                topleft: new _Vec2.default(this.options.position.x - this.options.distance, this.options.position.y - this.options.distance),\n\t                bottomright: new _Vec2.default(this.options.position.x + this.options.distance, this.options.position.y + this.options.distance)\n\t            };\n\t        }\n\t    }, {\n\t        key: 'center',\n\t        value: function center() {\n\t            return new _Vec2.default(this.options.distance, this.options.distance);\n\t        }\n\t    }, {\n\t        key: 'forEachSample',\n\t        value: function forEachSample(f) {\n\t            f(this.options.position);\n\t        }\n\t    }, {\n\t        key: '_getVisibleMaskCache',\n\t        value: function _getVisibleMaskCache() {\n\t            var d = Math.floor(this.options.distance * 1.4);\n\t            var hash = \"\" + d;\n\t            if (this.vismaskhash != hash) {\n\t                this.vismaskhash = hash;\n\t                var c = this._vismaskcache = createCanvasAnd2dContext('vm' + this.id, 2 * d, 2 * d);\n\t                var g = c.ctx.createRadialGradient(d, d, 0, d, d, d);\n\t                g.addColorStop(0, 'rgba(0,0,0,1)');\n\t                g.addColorStop(1, 'rgba(0,0,0,0)');\n\t                c.ctx.fillStyle = g;\n\t                c.ctx.fillRect(0, 0, c.w, c.h);\n\t            }\n\t            return this._vismaskcache;\n\t        }\n\t    }, {\n\t        key: '_getHashCache',\n\t        value: function _getHashCache() {\n\t            return [this.options.distance, this.options.diffuse].toString();\n\t        }\n\t    }]);\n\t\n\t    return Light;\n\t}();\n\t\n\texports.default = Light;\n\n/***/ }),\n/* 6 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\t\n\tObject.defineProperty(exports, \"__esModule\", {\n\t    value: true\n\t});\n\t\n\tvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\t\n\tvar _Vec = __webpack_require__(2);\n\t\n\tvar _Vec2 = _interopRequireDefault(_Vec);\n\t\n\tvar _Light2 = __webpack_require__(5);\n\t\n\tvar _Light3 = _interopRequireDefault(_Light2);\n\t\n\tvar _helpers = __webpack_require__(4);\n\t\n\tfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\t\n\tfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\t\n\tfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\t\n\tfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\t\n\tvar Lamp = function (_Light) {\n\t    _inherits(Lamp, _Light);\n\t\n\t    function Lamp(options) {\n\t        _classCallCheck(this, Lamp);\n\t\n\t        var _this = _possibleConstructorReturn(this, (Lamp.__proto__ || Object.getPrototypeOf(Lamp)).call(this));\n\t\n\t        var defaults = {\n\t            id: 0,\n\t            color: 'rgba(250,220,150,0.8)',\n\t            radius: 0,\n\t            samples: 1,\n\t            angle: 0,\n\t            roughness: 0\n\t        };\n\t        _this.options = Object.assign(defaults, _this.options);\n\t        _this.options = Object.assign(_this.options, options);\n\t        return _this;\n\t    }\n\t\n\t    _createClass(Lamp, [{\n\t        key: '_getHashCache',\n\t        value: function _getHashCache() {\n\t            return [this.options.color, this.options.distance, this.options.diffuse, this.options.angle, this.options.roughness, this.options.samples, this.options.radius].toString();\n\t        }\n\t    }, {\n\t        key: 'center',\n\t        value: function center() {\n\t            return new _Vec2.default((1 - Math.cos(this.options.angle) * this.options.roughness) * this.options.distance, (1 + Math.sin(this.options.angle) * this.options.roughness) * this.options.distance);\n\t        }\n\t    }, {\n\t        key: 'bounds',\n\t        value: function bounds() {\n\t            var orientationCenter = new _Vec2.default(Math.cos(this.options.angle), -Math.sin(this.options.angle)).mul(this.options.roughness * this.options.distance);\n\t            return {\n\t                topleft: new _Vec2.default(this.options.position.x + orientationCenter.x - this.options.distance, this.options.position.y + orientationCenter.y - this.options.distance),\n\t                bottomright: new _Vec2.default(this.options.position.x + orientationCenter.x + this.options.distance, this.options.position.y + orientationCenter.y + this.options.distance)\n\t            };\n\t        }\n\t    }, {\n\t        key: 'mask',\n\t        value: function mask(ctx) {\n\t            var c = this._getVisibleMaskCache();\n\t            var orientationCenter = new _Vec2.default(Math.cos(this.options.angle), -Math.sin(this.options.angle)).mul(this.options.roughness * this.options.distance);\n\t            ctx.drawImage(c.canvas, Math.round(this.options.position.x + orientationCenter.x - c.w / 2), Math.round(this.options.position.y + orientationCenter.y - c.h / 2));\n\t        }\n\t    }, {\n\t        key: '_getGradientCache',\n\t        value: function _getGradientCache(center) {\n\t            var hashcode = this._getHashCache();\n\t            if (this._cacheHashcode == hashcode) {\n\t                return this._gcache;\n\t            }\n\t            this._cacheHashcode = hashcode;\n\t            var d = Math.round(this.options.distance);\n\t            var D = d * 2;\n\t            var cache = (0, _helpers.createCanvasAnd2dContext)('gc' + this.id, D, D);\n\t            var g = cache.ctx.createRadialGradient(center.x, center.y, 0, d, d, d);\n\t            g.addColorStop(Math.min(1, this.options.radius / this.options.distance), this.options.color);\n\t            g.addColorStop(1, (0, _helpers.getRGBA)(this.options.color, 0));\n\t            cache.ctx.fillStyle = g;\n\t            cache.ctx.fillRect(0, 0, cache.w, cache.h);\n\t            return this._gcache = cache;\n\t        }\n\t    }, {\n\t        key: 'render',\n\t        value: function render(ctx) {\n\t            var center = this.center();\n\t            var c = this._getGradientCache(center);\n\t            ctx.drawImage(c.canvas, Math.round(this.options.position.x - center.x), Math.round(this.options.position.y - center.y));\n\t        }\n\t    }]);\n\t\n\t    return Lamp;\n\t}(_Light3.default);\n\t\n\texports.default = Lamp;\n\n/***/ }),\n/* 7 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\t\n\tObject.defineProperty(exports, \"__esModule\", {\n\t    value: true\n\t});\n\t\n\tvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\t\n\tvar _Vec = __webpack_require__(2);\n\t\n\tvar _Vec2 = _interopRequireDefault(_Vec);\n\t\n\tvar _helpers = __webpack_require__(4);\n\t\n\tvar _OpaqueObject2 = __webpack_require__(8);\n\t\n\tvar _OpaqueObject3 = _interopRequireDefault(_OpaqueObject2);\n\t\n\tfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\t\n\tfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\t\n\tfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\t\n\tfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\t\n\tvar DiscObject = function (_OpaqueObject) {\n\t    _inherits(DiscObject, _OpaqueObject);\n\t\n\t    function DiscObject(options) {\n\t        _classCallCheck(this, DiscObject);\n\t\n\t        var _this = _possibleConstructorReturn(this, (DiscObject.__proto__ || Object.getPrototypeOf(DiscObject)).call(this));\n\t\n\t        var defaults = {\n\t            center: new _Vec2.default(),\n\t            radius: 20\n\t        };\n\t        _this.options = Object.assign(defaults, _this.options);\n\t        _this.options = Object.assign(_this.options, options);\n\t        return _this;\n\t    }\n\t\n\t    _createClass(DiscObject, [{\n\t        key: 'cast',\n\t        value: function cast(ctx, origin, bounds) {\n\t            var m = this.options.center;\n\t            var originToM = m.sub(origin);\n\t            var tangentLines = (0, _helpers.getTan2)(this.options.radius, originToM);\n\t            var originToA = tangentLines[0];\n\t            var originToB = tangentLines[1];\n\t            var a = originToA.add(origin);\n\t            var b = originToB.add(origin);\n\t            // normalize to distance\n\t            var distance = (bounds.bottomright.x - bounds.topleft.x + (bounds.bottomright.y - bounds.topleft.y)) / 2;\n\t            originToM = originToM.normalize().mul(distance);\n\t            originToA = originToA.normalize().mul(distance);\n\t            originToB = originToB.normalize().mul(distance);\n\t            // project points\n\t            var oam = a.add(originToM);\n\t            var obm = b.add(originToM);\n\t            var ap = a.add(originToA);\n\t            var bp = b.add(originToB);\n\t            var start = Math.atan2(originToM.x, -originToM.y);\n\t            ctx.beginPath();\n\t            (0, _helpers.path)(ctx, [b, bp, obm, oam, ap, a], true);\n\t            ctx.arc(m.x, m.y, this.options.radius, start, start + Math.PI);\n\t            ctx.fill();\n\t        }\n\t    }, {\n\t        key: 'path',\n\t        value: function path(ctx) {\n\t            ctx.arc(this.options.center.x, this.options.center.y, this.options.radius, 0, _helpers._2PI);\n\t        }\n\t    }, {\n\t        key: 'bounds',\n\t        value: function bounds() {\n\t            return {\n\t                topleft: new _Vec2.default(this.options.center.x - this.options.radius, this.options.center.y - this.options.radius),\n\t                bottomright: new _Vec2.default(this.options.center.x + this.options.radius, this.options.center.y + this.options.radius)\n\t            };\n\t        }\n\t    }, {\n\t        key: 'contains',\n\t        value: function contains(point) {\n\t            return point.dist2(this.options.center) < this.options.radius * this.options.radius;\n\t        }\n\t    }]);\n\t\n\t    return DiscObject;\n\t}(_OpaqueObject3.default);\n\t\n\texports.default = DiscObject;\n\n/***/ }),\n/* 8 */\n/***/ (function(module, exports) {\n\n\t\"use strict\";\n\t\n\tObject.defineProperty(exports, \"__esModule\", {\n\t    value: true\n\t});\n\t\n\tvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\t\n\tfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\t\n\tvar OpaqueObject = function () {\n\t    function OpaqueObject(options) {\n\t        _classCallCheck(this, OpaqueObject);\n\t\n\t        var defaults = {\n\t            diffuse: 0.8\n\t        };\n\t        this.options = Object.assign(defaults, options);\n\t        this.uniqueId = 0;\n\t    }\n\t\n\t    _createClass(OpaqueObject, [{\n\t        key: \"cast\",\n\t        value: function cast(ctx, origin, bounds) {}\n\t    }, {\n\t        key: \"path\",\n\t        value: function path(ctx) {}\n\t    }, {\n\t        key: \"bounds\",\n\t        value: function bounds() {\n\t            return {\n\t                topleft: new Vec2(),\n\t                bottomright: new Vec2()\n\t            };\n\t        }\n\t    }, {\n\t        key: \"contains\",\n\t        value: function contains(point) {\n\t            return false;\n\t        }\n\t    }]);\n\t\n\t    return OpaqueObject;\n\t}();\n\t\n\texports.default = OpaqueObject;\n\n/***/ }),\n/* 9 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\t\n\tObject.defineProperty(exports, \"__esModule\", {\n\t    value: true\n\t});\n\t\n\tvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\t\n\tvar _Vec = __webpack_require__(2);\n\t\n\tvar _Vec2 = _interopRequireDefault(_Vec);\n\t\n\tvar _PolygonObject2 = __webpack_require__(10);\n\t\n\tvar _PolygonObject3 = _interopRequireDefault(_PolygonObject2);\n\t\n\tfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\t\n\tfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\t\n\tfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\t\n\tfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\t\n\tvar RectangleObject = function (_PolygonObject) {\n\t    _inherits(RectangleObject, _PolygonObject);\n\t\n\t    function RectangleObject(options) {\n\t        _classCallCheck(this, RectangleObject);\n\t\n\t        var _this = _possibleConstructorReturn(this, (RectangleObject.__proto__ || Object.getPrototypeOf(RectangleObject)).call(this, options));\n\t\n\t        var defaults = {\n\t            topleft: new _Vec2.default(),\n\t            bottomright: new _Vec2.default()\n\t        };\n\t        _this.options = Object.assign(defaults, _this.options);\n\t        _this.options = Object.assign(_this.options, options);\n\t        _this.syncFromTopleftBottomright();\n\t        return _this;\n\t    }\n\t\n\t    _createClass(RectangleObject, [{\n\t        key: 'syncFromTopleftBottomright',\n\t        value: function syncFromTopleftBottomright() {\n\t            var a = this.options.topleft;\n\t            var b = new _Vec2.default(this.options.bottomright.x, this.options.topleft.y);\n\t            var c = this.options.bottomright;\n\t            var d = new _Vec2.default(this.options.topleft.x, this.options.bottomright.y);\n\t            this.options.points = [a, b, c, d];\n\t        }\n\t    }, {\n\t        key: 'fill',\n\t        value: function fill(ctx) {\n\t            var x = this.options.points[0].x,\n\t                y = this.options.points[0].y;\n\t            ctx.rect(x, y, this.options.points[2].x - x, this.options.points[2].y - y);\n\t        }\n\t    }]);\n\t\n\t    return RectangleObject;\n\t}(_PolygonObject3.default);\n\t\n\texports.default = RectangleObject;\n\n/***/ }),\n/* 10 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\t\n\tObject.defineProperty(exports, \"__esModule\", {\n\t    value: true\n\t});\n\t\n\tvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\t\n\tvar _Vec = __webpack_require__(2);\n\t\n\tvar _Vec2 = _interopRequireDefault(_Vec);\n\t\n\tvar _helpers = __webpack_require__(4);\n\t\n\tvar _OpaqueObject2 = __webpack_require__(8);\n\t\n\tvar _OpaqueObject3 = _interopRequireDefault(_OpaqueObject2);\n\t\n\tfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\t\n\tfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\t\n\tfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\t\n\tfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\t\n\tvar PolygonObject = function (_OpaqueObject) {\n\t    _inherits(PolygonObject, _OpaqueObject);\n\t\n\t    function PolygonObject(options) {\n\t        _classCallCheck(this, PolygonObject);\n\t\n\t        var _this = _possibleConstructorReturn(this, (PolygonObject.__proto__ || Object.getPrototypeOf(PolygonObject)).call(this));\n\t\n\t        var defaults = {\n\t            points: []\n\t        };\n\t        _this.options = Object.assign(defaults, _this.options);\n\t        _this.options = Object.assign(_this.options, options);\n\t        return _this;\n\t    }\n\t\n\t    _createClass(PolygonObject, [{\n\t        key: 'bounds',\n\t        value: function bounds() {\n\t            var topleft = this.options.points[0].copy();\n\t            var bottomright = topleft.copy();\n\t            for (var p = 1, l = this.options.points.length; p < l; ++p) {\n\t                var point = this.options.points[p];\n\t                if (point.x > bottomright.x) bottomright.x = point.x;\n\t                if (point.y > bottomright.y) bottomright.y = point.y;\n\t                if (point.x < topleft.x) topleft.x = point.x;\n\t                if (point.y < topleft.y) topleft.y = point.y;\n\t            }\n\t            return {\n\t                topleft: topleft,\n\t                bottomright: bottomright\n\t            };\n\t        }\n\t    }, {\n\t        key: 'contains',\n\t        value: function contains(p) {\n\t            var points = this.options.points;\n\t            var i,\n\t                l = points.length,\n\t                j = l - 1;\n\t            var x = p.x,\n\t                y = p.y;\n\t            var oddNodes = false;\n\t\n\t            for (i = 0; i < l; i++) {\n\t                if ((points[i].y < y && points[j].y >= y || points[j].y < y && points[i].y >= y) && (points[i].x <= x || points[j].x <= x)) {\n\t                    if (points[i].x + (y - points[i].y) / (points[j].y - points[i].y) * (points[j].x - points[i].x) < x) {\n\t                        oddNodes = !oddNodes;\n\t                    }\n\t                }\n\t                j = i;\n\t            }\n\t            return oddNodes;\n\t        }\n\t    }, {\n\t        key: 'path',\n\t        value: function path(ctx) {\n\t            (0, _helpers.path)(ctx, this.options.points);\n\t        }\n\t    }, {\n\t        key: 'cast',\n\t        value: function cast(ctx, origin, bounds) {\n\t            // The current implementation of projection is a bit hacky... do you have a proper solution?\n\t            var distance = (bounds.bottomright.x - bounds.topleft.x + (bounds.bottomright.y - bounds.topleft.y)) / 2;\n\t            this._forEachVisibleEdges(origin, bounds, function (a, b, originToA, originToB, aToB) {\n\t                var m; // m is the projected point of origin to [a, b]\n\t                var t = originToA.inv().dot(aToB) / aToB.length2();\n\t                if (t < 0) m = a;else if (t > 1) m = b;else m = a.add(aToB.mul(t));\n\t                var originToM = m.sub(origin);\n\t                // normalize to distance\n\t                originToM = originToM.normalize().mul(distance);\n\t                originToA = originToA.normalize().mul(distance);\n\t                originToB = originToB.normalize().mul(distance);\n\t                // project points\n\t                var oam = a.add(originToM);\n\t                var obm = b.add(originToM);\n\t                var ap = a.add(originToA);\n\t                var bp = b.add(originToB);\n\t                ctx.beginPath();\n\t                (0, _helpers.path)(ctx, [a, b, bp, obm, oam, ap]);\n\t                ctx.fill();\n\t            });\n\t        }\n\t    }, {\n\t        key: '_forEachVisibleEdges',\n\t        value: function _forEachVisibleEdges(origin, bounds, f) {\n\t            var a = this.options.points[this.options.points.length - 1],\n\t                b;\n\t            for (var p = 0, l = this.options.points.length; p < l; ++p, a = b) {\n\t                b = this.options.points[p];\n\t                if (a.inBound(bounds.topleft, bounds.bottomright)) {\n\t                    var originToA = a.sub(origin);\n\t                    var originToB = b.sub(origin);\n\t                    var aToB = b.sub(a);\n\t                    var normal = new _Vec2.default(aToB.y, -aToB.x);\n\t                    if (normal.dot(originToA) < 0) {\n\t                        f(a, b, originToA, originToB, aToB);\n\t                    }\n\t                }\n\t            }\n\t        }\n\t    }]);\n\t\n\t    return PolygonObject;\n\t}(_OpaqueObject3.default);\n\t\n\texports.default = PolygonObject;\n\n/***/ })\n/******/ ]);\n\n\n// WEBPACK FOOTER //\n// illuminated.js"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/built/\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap ef47299c52806ce75b3c","import Vec2 from './Vec2.js'\r\nimport Lighting from './Lighting.js'\r\n\r\nimport Lamp from './Lamp.js'\r\n\r\nimport DiscObject from './DiscObject.js'\r\nimport RectangleObject from \"./RectangleObject\"\r\n\r\n\r\n//!STAexport RT\r\nvar canvas = document.getElementById(\"screen\")\r\nvar ctx = canvas.getContext(\"2d\")\r\nvar light = new Lamp({\r\n    position: new Vec2(200, 150),\r\n    distance: 200\r\n})\r\nvar disc = new DiscObject({\r\n    center: new Vec2(100, 100),\r\n    radius: 30\r\n})\r\nvar rect = new RectangleObject({\r\n    topleft: new Vec2(250, 200),\r\n    bottomright: new Vec2(350, 250)\r\n})\r\nconsole.log(\"RECT\", rect)\r\nvar lighting = new Lighting({\r\n    light: light,\r\n    objects: [disc, rect]\r\n})\r\nlighting.compute(canvas.width, canvas.height)\r\nctx.fillStyle = \"black\"\r\nctx.fillRect(0, 0, canvas.width, canvas.height)\r\nlighting.render(ctx)\n\n\n// WEBPACK FOOTER //\n// ./src/illuminated.js","class Vec2 {\r\n    constructor(x, y) {\r\n        this.x = x || 0\r\n        this.y = y || 0\r\n    }\r\n\r\n    copy() {\r\n        return new Vec2(this.x, this.y)\r\n    }\r\n\r\n    dot(v) {\r\n        return v.x * this.x + v.y * this.y\r\n    }\r\n\r\n    sub(v) {\r\n        return new Vec2(this.x - v.x, this.y - v.y)\r\n    }\r\n\r\n    add(v) {\r\n        return new Vec2(this.x + v.x, this.y + v.y)\r\n    }\r\n\r\n    mul(n) {\r\n        return new Vec2(this.x * n, this.y * n)\r\n    }\r\n\r\n    inv() {\r\n        return this.mul(-1)\r\n    }\r\n\r\n    dist2(v) {\r\n        let dx = this.x - v.x\r\n        let dy = this.y - v.y\r\n        return dx * dx + dy * dy\r\n    }\r\n\r\n    normalize() {\r\n        let length = Math.sqrt(this.length2())\r\n        return new Vec2(this.x / length, this.y / length)\r\n    }\r\n\r\n    length2(v) {\r\n        return this.x * this.x + this.y * this.y\r\n    }\r\n\r\n    toString() {\r\n        return this.x + \",\" + this.y\r\n    }\r\n\r\n    inBound(topLeft, bottomRight) {\r\n        return (topLeft.x < this.x && this.x < bottomRight.x &&\r\n            topLeft.y < this.y && this.y < bottomRight.y)\r\n    }\r\n}\r\n\r\nexport default Vec2\n\n\n// WEBPACK FOOTER //\n// ./src/Vec2.js","import { createCanvasAnd2dContext } from './helpers.js'\r\nimport Light from './Light.js'\r\n\r\nclass Lighting {\r\n    constructor(options) {\r\n        const defaults = {\r\n            light: new Light(),\r\n            objects: []\r\n        }\r\n        this.options = Object.assign(defaults, this.options)\r\n        this.options = Object.assign(this.options, options)\r\n    }\r\n\r\n    createCache(w, h) {\r\n        this._cache = createCanvasAnd2dContext('lc', w, h)\r\n        this._castcache = createCanvasAnd2dContext('lcc', w, h)\r\n    }\r\n\r\n    cast(ctxoutput) {\r\n        var light = this.options.light\r\n        var n = light.samples\r\n        var c = this._castcache\r\n        var ctx = c.ctx\r\n        ctx.clearRect(0, 0, c.w, c.h)\r\n        // Draw shadows for each light sample and objects\r\n        ctx.fillStyle = \"rgba(0,0,0,\" + Math.round(100 / n) / 100 + \")\" // Is there any better way?\r\n        var bounds = light.bounds()\r\n        var objects = this.options.objects\r\n        light.forEachSample(function (position) {\r\n            var sampleInObject = false\r\n            for (var o = 0, l = objects.length; o < l; ++o) {\r\n                if (objects[o].contains(position)) {\r\n                    ctx.fillRect(bounds.topleft.x, bounds.topleft.y, bounds.bottomright.x - bounds.topleft.x, bounds.bottomright.y - bounds.topleft.y);\r\n                    return\r\n                }\r\n            }\r\n            objects.forEach(function (object) {\r\n                object.cast(ctx, position, bounds)\r\n            })\r\n        })\r\n        // Draw objects diffuse - the intensity of the light penetration in objects\r\n        objects.forEach(function (object) {\r\n            var diffuse = object.diffuse === undefined ? 0.8 : object.diffuse\r\n            diffuse *= light.diffuse\r\n            ctx.fillStyle = \"rgba(0,0,0,\" + (1 - diffuse) + \")\"\r\n            ctx.beginPath()\r\n            object.path(ctx)\r\n            ctx.fill()\r\n        })\r\n        ctxoutput.drawImage(c.canvas, 0, 0)\r\n    }\r\n\r\n    compute(w, h) {\r\n        if (!this._cache || this._cache.w != w || this._cache.h != h)\r\n            this.createCache(w, h)\r\n        var ctx = this._cache.ctx\r\n        var light = this.options.light\r\n        ctx.save()\r\n        ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height)\r\n\r\n        light.render(ctx)\r\n        ctx.globalCompositeOperation = \"destination-out\"\r\n        this.cast(ctx)\r\n        ctx.restore()\r\n    }\r\n\r\n    render(ctx) {\r\n        ctx.drawImage(this._cache.canvas, 0, 0)\r\n    }\r\n\r\n    getCanvas() {\r\n        return this._cache.canvas\r\n    }\r\n}\r\n\r\nexport default Lighting\n\n\n// WEBPACK FOOTER //\n// ./src/Lighting.js","import Vec2 from './Vec2.js'\r\n\r\nexport const GOLDEN_ANGLE = Math.PI * (3 - Math.sqrt(5))\r\nexport const _2PI = 2 * Math.PI\r\n\r\nfunction path(ctx, points, dontJoinLast) {\r\n    var p = points[0]\r\n    ctx.moveTo(p.x, p.y)\r\n    for (var i = 1, l = points.length; i < l; ++i) {\r\n        p = points[i]\r\n        ctx.lineTo(p.x, p.y)\r\n    }\r\n    if (!dontJoinLast && points.length > 2) {\r\n        p = points[0]\r\n        ctx.lineTo(p.x, p.y)\r\n    }\r\n}\r\n\r\nfunction createCanvasAnd2dContext(id, w, h) {\r\n    var iid = 'illujs_' + id\r\n    var canvas = document.getElementById(iid)\r\n\r\n    if (canvas === null) {\r\n        var canvas = document.createElement(\"canvas\")\r\n        canvas.id = iid\r\n        canvas.width = w\r\n        canvas.height = h\r\n        canvas.style.display = 'none'\r\n        document.body.appendChild(canvas)\r\n    }\r\n\r\n    var ctx = canvas.getContext(\"2d\")\r\n    ctx.clearRect(0, 0, canvas.width, canvas.height)\r\n\r\n    canvas.width = w\r\n    canvas.height = h\r\n\r\n    return {\r\n        canvas: canvas,\r\n        ctx: ctx,\r\n        w: w,\r\n        h: h\r\n    }\r\n}\r\n\r\nvar getRGBA = (function () {\r\n    //var ctx = createCanvasAnd2dContext('grgba', 1, 1)\r\n    var canvas = document.createElement(\"canvas\")\r\n    canvas.width = canvas.height = 1\r\n    var ctx = canvas.getContext(\"2d\")\r\n\r\n    return function (color, alpha) {\r\n        ctx.clearRect(0, 0, 1, 1)\r\n        ctx.fillStyle = color\r\n        ctx.fillRect(0, 0, 1, 1)\r\n        var d = ctx.getImageData(0, 0, 1, 1).data\r\n        return 'rgba(' + [d[0], d[1], d[2], alpha] + ')'\r\n    }\r\n}())\r\n\r\nfunction getTan2(radius, center) {\r\n    var epsilon = getTan2.epsilon || 1e-6, // constant\r\n        x0, y0, len2, soln,\r\n        solutions = [],\r\n        a = radius\r\n    if (typeof a === \"object\" && typeof center === \"number\") {\r\n        var tmp = a\r\n        center = a\r\n        center = tmp // swap\r\n    }\r\n    if (typeof center === \"number\") {\r\n        // getTan2(radius:number, x0:number, y0:number)\r\n        x0 = center\r\n        y0 = arguments[2]\r\n        len2 = x0 * x0 + y0 * y0\r\n    } else {\r\n        // getTans2(radius:number, center:object={x:x0,y:y0})\r\n        x0 = center.x\r\n        y0 = center.y\r\n        len2 = center.length2()\r\n    }\r\n    // t = +/- Math.acos( (-a*x0 +/- y0 * Math.sqrt(x0*x0 + y0*y0 - a*a))/(x0*x0 + y0*y) )\r\n    var len2a = y0 * Math.sqrt(len2 - a * a),\r\n        tt = Math.acos((-a * x0 + len2a) / len2),\r\n        nt = Math.acos((-a * x0 - len2a) / len2),\r\n        tt_cos = a * Math.cos(tt),\r\n        tt_sin = a * Math.sin(tt),\r\n        nt_cos = a * Math.cos(nt),\r\n        nt_sin = a * Math.sin(nt)\r\n\r\n    // Note: cos(-t) == cos(t) and sin(-t) == -sin(t) for all t, so find\r\n    // x0 + a*cos(t), y0 +/- a*sin(t)\r\n    // Solutions have equal lengths\r\n    soln = new Vec2(x0 + nt_cos, y0 + nt_sin)\r\n    solutions.push(soln)\r\n    var dist0 = soln.length2()\r\n\r\n    soln = new Vec2(x0 + tt_cos, y0 - tt_sin)\r\n    solutions.push(soln)\r\n    var dist1 = soln.length2()\r\n    if (Math.abs(dist0 - dist1) < epsilon) return solutions\r\n\r\n    soln = new Vec2(x0 + nt_cos, y0 - nt_sin)\r\n    solutions.push(soln)\r\n    var dist2 = soln.length2()\r\n    // Changed order so no strange X of light inside the circle. Could also sort results.\r\n    if (Math.abs(dist1 - dist2) < epsilon) return [soln, solutions[1]]\r\n    if (Math.abs(dist0 - dist2) < epsilon) return [solutions[0], soln]\r\n\r\n    soln = new Vec2(x0 + tt_cos, y0 + tt_sin)\r\n    solutions.push(soln)\r\n    var dist3 = soln.length2()\r\n    if (Math.abs(dist2 - dist3) < epsilon) return [solutions[2], soln]\r\n    if (Math.abs(dist1 - dist3) < epsilon) return [solutions[1], soln]\r\n    if (Math.abs(dist0 - dist3) < epsilon) return [solutions[0], soln]\r\n\r\n    // return all 4 solutions if no matching vector lengths found.\r\n    return solutions\r\n}\r\n\r\nexport {\r\n    createCanvasAnd2dContext,\r\n    getRGBA,\r\n    getTan2,\r\n    path\r\n}\n\n\n// WEBPACK FOOTER //\n// ./src/helpers.js","import Vec2 from './Vec2.js'\r\n\r\nclass Light {\r\n    constructor(options) {\r\n        const defaults = {\r\n            position: new Vec2(),\r\n            distance: 100,\r\n            diffuse: 0.8\r\n        }\r\n        this.options = Object.assign(defaults, options)\r\n    }\r\n\r\n    render(ctx) {}\r\n\r\n    mask(ctx) {\r\n        var c = this._getVisibleMaskCache()\r\n        ctx.drawImage(\r\n            c.canvas,\r\n            Math.round(this.options.position.x - c.w / 2),\r\n            Math.round(this.options.position.y - c.h / 2)\r\n        )\r\n    }\r\n\r\n    bounds() {\r\n        return {\r\n            topleft: new Vec2(this.options.position.x - this.options.distance, this.options.position.y - this.options.distance),\r\n            bottomright: new Vec2(this.options.position.x + this.options.distance, this.options.position.y + this.options.distance)\r\n        }\r\n    }\r\n\r\n    center() {\r\n        return new Vec2(this.options.distance, this.options.distance)\r\n    }\r\n\r\n    forEachSample(f) {\r\n        f(this.options.position)\r\n    }\r\n\r\n    _getVisibleMaskCache() {\r\n        var d = Math.floor(this.options.distance * 1.4)\r\n        var hash = \"\" + d\r\n        if (this.vismaskhash != hash) {\r\n            this.vismaskhash = hash\r\n            var c = this._vismaskcache = createCanvasAnd2dContext('vm' + this.id, 2 * d, 2 * d)\r\n            var g = c.ctx.createRadialGradient(d, d, 0, d, d, d)\r\n            g.addColorStop(0, 'rgba(0,0,0,1)')\r\n            g.addColorStop(1, 'rgba(0,0,0,0)')\r\n            c.ctx.fillStyle = g\r\n            c.ctx.fillRect(0, 0, c.w, c.h)\r\n        }\r\n        return this._vismaskcache\r\n    }\r\n\r\n    _getHashCache() {\r\n        return [this.options.distance, this.options.diffuse].toString()\r\n    }\r\n}\r\n\r\nexport default Light\n\n\n// WEBPACK FOOTER //\n// ./src/Light.js","import Vec2 from './Vec2'\r\nimport Light from './Light.js'\r\nimport { createCanvasAnd2dContext, getRGBA } from './helpers.js'\r\n\r\nclass Lamp extends Light {\r\n    constructor(options) {\r\n        super()\r\n        const defaults = {\r\n            id: 0,\r\n            color: 'rgba(250,220,150,0.8)',\r\n            radius: 0,\r\n            samples: 1,\r\n            angle: 0,\r\n            roughness: 0\r\n        }\r\n        this.options = Object.assign(defaults, this.options)\r\n        this.options = Object.assign(this.options, options)\r\n    }\r\n\r\n    _getHashCache() {\r\n        return [\r\n            this.options.color,\r\n            this.options.distance,\r\n            this.options.diffuse,\r\n            this.options.angle,\r\n            this.options.roughness,\r\n            this.options.samples,\r\n            this.options.radius\r\n        ].toString()\r\n    }\r\n\r\n    center() {\r\n        return new Vec2(\r\n            (1 - Math.cos(this.options.angle) * this.options.roughness) * this.options.distance,\r\n            (1 + Math.sin(this.options.angle) * this.options.roughness) * this.options.distance\r\n        )\r\n    }\r\n\r\n    bounds() {\r\n        var orientationCenter = new Vec2(\r\n            Math.cos(this.options.angle), -Math.sin(this.options.angle)\r\n        ).mul(this.options.roughness * this.options.distance)\r\n        return {\r\n            topleft: new Vec2(\r\n                this.options.position.x + orientationCenter.x - this.options.distance,\r\n                this.options.position.y + orientationCenter.y - this.options.distance\r\n            ),\r\n            bottomright: new Vec2(\r\n                this.options.position.x + orientationCenter.x + this.options.distance,\r\n                this.options.position.y + orientationCenter.y + this.options.distance\r\n            )\r\n        }\r\n    }\r\n\r\n    mask(ctx) {\r\n        var c = this._getVisibleMaskCache()\r\n        var orientationCenter = new Vec2(\r\n            Math.cos(this.options.angle), -Math.sin(this.options.angle)\r\n        ).mul(this.options.roughness * this.options.distance)\r\n        ctx.drawImage(\r\n            c.canvas, Math.round(this.options.position.x + orientationCenter.x - c.w / 2),\r\n            Math.round(this.options.position.y + orientationCenter.y - c.h / 2)\r\n        )\r\n    }\r\n\r\n    _getGradientCache(center) {\r\n        var hashcode = this._getHashCache()\r\n        if (this._cacheHashcode == hashcode) {\r\n            return this._gcache\r\n        }\r\n        this._cacheHashcode = hashcode\r\n        var d = Math.round(this.options.distance)\r\n        var D = d * 2\r\n        var cache = createCanvasAnd2dContext('gc' + this.id, D, D)\r\n        var g = cache.ctx.createRadialGradient(center.x, center.y, 0, d, d, d)\r\n        g.addColorStop(Math.min(1, this.options.radius / this.options.distance), this.options.color)\r\n        g.addColorStop(1, getRGBA(this.options.color, 0))\r\n        cache.ctx.fillStyle = g\r\n        cache.ctx.fillRect(0, 0, cache.w, cache.h)\r\n        return this._gcache = cache\r\n    }\r\n\r\n    render(ctx) {\r\n        var center = this.center()\r\n        var c = this._getGradientCache(center)\r\n        ctx.drawImage(\r\n            c.canvas,\r\n            Math.round(this.options.position.x - center.x),\r\n            Math.round(this.options.position.y - center.y)\r\n        )\r\n    }\r\n}\r\n\r\nexport default Lamp\n\n\n// WEBPACK FOOTER //\n// ./src/Lamp.js","import Vec2 from './Vec2.js'\r\nimport { getTan2, path, _2PI } from './helpers.js'\r\nimport OpaqueObject from './OpaqueObject.js'\r\n\r\nclass DiscObject extends OpaqueObject {\r\n    constructor(options) {\r\n        super()\r\n        const defaults = {\r\n            center: new Vec2(),\r\n            radius: 20\r\n        }\r\n        this.options = Object.assign(defaults, this.options)\r\n        this.options = Object.assign(this.options, options)\r\n    }\r\n    cast(ctx, origin, bounds) {\r\n        var m = this.options.center\r\n        var originToM = m.sub(origin)\r\n        var tangentLines = getTan2(this.options.radius, originToM)\r\n        var originToA = tangentLines[0]\r\n        var originToB = tangentLines[1]\r\n        var a = originToA.add(origin)\r\n        var b = originToB.add(origin)\r\n        // normalize to distance\r\n        var distance = ((bounds.bottomright.x - bounds.topleft.x) + (bounds.bottomright.y - bounds.topleft.y)) / 2\r\n        originToM = originToM.normalize().mul(distance)\r\n        originToA = originToA.normalize().mul(distance)\r\n        originToB = originToB.normalize().mul(distance)\r\n        // project points\r\n        var oam = a.add(originToM)\r\n        var obm = b.add(originToM)\r\n        var ap = a.add(originToA)\r\n        var bp = b.add(originToB)\r\n        var start = Math.atan2(originToM.x, -originToM.y)\r\n        ctx.beginPath()\r\n        path(ctx, [b, bp, obm, oam, ap, a], true)\r\n        ctx.arc(m.x, m.y, this.options.radius, start, start + Math.PI)\r\n        ctx.fill()\r\n    }\r\n    path(ctx) {\r\n        ctx.arc(this.options.center.x, this.options.center.y, this.options.radius, 0, _2PI)\r\n    }\r\n    bounds() {\r\n        return {\r\n            topleft: new Vec2(this.options.center.x - this.options.radius, this.options.center.y - this.options.radius),\r\n            bottomright: new Vec2(this.options.center.x + this.options.radius, this.options.center.y + this.options.radius)\r\n        }\r\n    }\r\n    contains(point) {\r\n        return point.dist2(this.options.center) < this.options.radius * this.options.radius\r\n    }\r\n}\r\n\r\nexport default DiscObject\n\n\n// WEBPACK FOOTER //\n// ./src/DiscObject.js","class OpaqueObject {\r\n    constructor(options) {\r\n        const defaults = {\r\n            diffuse: 0.8\r\n        }\r\n        this.options = Object.assign(defaults, options)\r\n        this.uniqueId = 0\r\n    }\r\n\r\n    cast(ctx, origin, bounds) {}\r\n\r\n    path(ctx) {}\r\n\r\n    bounds() {\r\n        return {\r\n            topleft: new Vec2(),\r\n            bottomright: new Vec2()\r\n        }\r\n    }\r\n\r\n    contains(point) {\r\n        return false\r\n    }\r\n}\r\n\r\nexport default OpaqueObject\n\n\n// WEBPACK FOOTER //\n// ./src/OpaqueObject.js","import Vec2 from './Vec2.js'\r\nimport PolygonObject from './PolygonObject.js'\r\n\r\nclass RectangleObject extends PolygonObject {\r\n    constructor(options) {\r\n        super(options)\r\n        const defaults = {\r\n            topleft: new Vec2(),\r\n            bottomright: new Vec2()\r\n        }\r\n        this.options = Object.assign(defaults, this.options)\r\n        this.options = Object.assign(this.options, options)\r\n        this.syncFromTopleftBottomright()\r\n    }\r\n    syncFromTopleftBottomright() {\r\n        var a = this.options.topleft\r\n        var b = new Vec2(this.options.bottomright.x, this.options.topleft.y)\r\n        var c = this.options.bottomright\r\n        var d = new Vec2(this.options.topleft.x, this.options.bottomright.y)\r\n        this.options.points = [a, b, c, d]\r\n    }\r\n    fill(ctx) {\r\n        var x = this.options.points[0].x, y = this.options.points[0].y\r\n        ctx.rect(x, y, this.options.points[2].x - x, this.options.points[2].y - y)\r\n    }\r\n}\r\n\r\nexport default RectangleObject\n\n\n// WEBPACK FOOTER //\n// ./src/RectangleObject.js","import Vec2 from './Vec2.js'\r\nimport { path } from './helpers.js'\r\nimport OpaqueObject from './OpaqueObject.js'\r\n\r\nclass PolygonObject extends OpaqueObject {\r\n    constructor(options) {\r\n        super()\r\n        const defaults = {\r\n            points: []\r\n        }\r\n        this.options = Object.assign(defaults, this.options)\r\n        this.options = Object.assign(this.options, options)\r\n    }\r\n\r\n    bounds() {\r\n        var topleft = this.options.points[0].copy()\r\n        var bottomright = topleft.copy()\r\n        for (var p = 1, l = this.options.points.length; p < l; ++p) {\r\n            var point = this.options.points[p]\r\n            if (point.x > bottomright.x)\r\n                bottomright.x = point.x\r\n            if (point.y > bottomright.y)\r\n                bottomright.y = point.y\r\n            if (point.x < topleft.x)\r\n                topleft.x = point.x\r\n            if (point.y < topleft.y)\r\n                topleft.y = point.y\r\n        }\r\n        return {\r\n            topleft: topleft,\r\n            bottomright: bottomright\r\n        }\r\n    }\r\n\r\n    contains(p) {\r\n        var points = this.options.points\r\n        var i, l = points.length,\r\n            j = l - 1\r\n        var x = p.x,\r\n            y = p.y\r\n        var oddNodes = false\r\n\r\n        for (i = 0; i < l; i++) {\r\n            if ((points[i].y < y && points[j].y >= y ||\r\n                    points[j].y < y && points[i].y >= y) &&\r\n                (points[i].x <= x || points[j].x <= x)) {\r\n                if (points[i].x + (y - points[i].y) / (points[j].y - points[i].y) * (points[j].x - points[i].x) < x) {\r\n                    oddNodes = !oddNodes\r\n                }\r\n            }\r\n            j = i\r\n        }\r\n        return oddNodes\r\n    }\r\n\r\n    path(ctx) {\r\n        path(ctx, this.options.points)\r\n    }\r\n\r\n    cast(ctx, origin, bounds) {\r\n        // The current implementation of projection is a bit hacky... do you have a proper solution?\r\n        var distance = ((bounds.bottomright.x - bounds.topleft.x) + (bounds.bottomright.y - bounds.topleft.y)) / 2\r\n        this._forEachVisibleEdges(origin, bounds, function (a, b, originToA, originToB, aToB) {\r\n            var m // m is the projected point of origin to [a, b]\r\n            var t = originToA.inv().dot(aToB) / aToB.length2()\r\n            if (t < 0)\r\n                m = a\r\n            else if (t > 1)\r\n                m = b\r\n            else\r\n                m = a.add(aToB.mul(t))\r\n            var originToM = m.sub(origin)\r\n            // normalize to distance\r\n            originToM = originToM.normalize().mul(distance)\r\n            originToA = originToA.normalize().mul(distance)\r\n            originToB = originToB.normalize().mul(distance)\r\n            // project points\r\n            var oam = a.add(originToM)\r\n            var obm = b.add(originToM)\r\n            var ap = a.add(originToA)\r\n            var bp = b.add(originToB)\r\n            ctx.beginPath()\r\n            path(ctx, [a, b, bp, obm, oam, ap])\r\n            ctx.fill()\r\n        })\r\n    }\r\n\r\n    _forEachVisibleEdges(origin, bounds, f) {\r\n        var a = this.options.points[this.options.points.length - 1],\r\n            b\r\n        for (var p = 0, l = this.options.points.length; p < l; ++p, a = b) {\r\n            b = this.options.points[p]\r\n            if (a.inBound(bounds.topleft, bounds.bottomright)) {\r\n                var originToA = a.sub(origin)\r\n                var originToB = b.sub(origin)\r\n                var aToB = b.sub(a)\r\n                var normal = new Vec2(aToB.y, -aToB.x)\r\n                if (normal.dot(originToA) < 0) {\r\n                    f(a, b, originToA, originToB, aToB)\r\n                }\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nexport default PolygonObject\n\n\n// WEBPACK FOOTER //\n// ./src/PolygonObject.js"],"sourceRoot":""}